# Serverless Framework Enterprise - AWS Access Role

Serverless Framework Enterprise AWS Access Role helps you secure your service deployments by enabling Serverless Framework Enterprise to issue temporary AWS Access Keys to deploy your services to AWS.

A Serverless Framework service without the Enterprise Plugin uses the AWS Access Keys stored in [environment variables](https://serverless.com/framework/docs/providers/aws/guide/credentials/) or [AWS Profiles](https://serverless.com/framework/docs/providers/aws/guide/credentials/). 

With AWS Access Roles the AWS Access Keys are generated by Serverless Enterprise on every command and the credentials expire after one hour.  Serverless Framework Enterprise leverages AWS Security Token Service and the AssumeRole API to automate creating and usage of temporary credentials, so your developers can stay productive and work securely without doing this manually.

## Minimum Version Requirements

You must deploy or redeploy that Service using Serverless Framework open-source CLI version 1.43.0 or later with the Enterprise Plugin version 1.0.0 or later.

## Upgrading


The Enterprise Plugin version 0.5.1 and earlier used the `${secrets}` variable to load the AWS from the list of available AWS Access Roles in the AWS Tenant. As of version 1.0.0 of the Enterprise Plugin, the credentials are loaded automatically based on the deployment profile associated with the application or stage. If you were using the AWS Access Role feature in Serverless Framework Enterprise with the enterprise plugin version 0.5.1 or earlier, then you will need to make a few updates:

1. [Update the Serverless Framework to version 1.43.0 or later](./update.md)
2. Find the line in `serverless.yml` containing `credentials: ${secrets:<secret-id>}`. You will need the Role ARN associated with the `<secret-id>`. If you do not know it, you can go to the [AWS Console for IAM Roles](https://console.aws.amazon.com/iam/home#/roles) and copy the Role ARN for the role.
3. Follow the instructions in [Link your AWS Account](#link-your-aws-account); however, use the Role ARN from the previous step instead of generating  new one.
4. Delete the line in `serverless.yml` containing `credentials: ${secrets:<secret-id>}`.

## Link your AWS Account

1. Open https://dashboard.serverless.com/
2. Once logged in, click "**profiles**" near the top of the page.
3. Navigate to the profile you would like to configure with the AWS Access Role.
4. In the **AWS credential access role** tab, expand the "_how to add a role_".
5. Follow the directions which will take you through creating an IAM Role for Serverless Framework Enterprise.
6. Click "**save changes**" in the deployment profile to save the IAM Role ARN to the profile.


## Test your configuration

Before you run `serverless deploy` ensure that the Serverless Framework open-source CLI is resolving the new AWS Access Keys from Enterprise.

```
serverless info
```

This command requires authentication therefore requires that the AWS Access Keys from Enterprise to be resolved. You should expect this command to succeed.


## Use the generated AWS Access Keys in your service

You don't have to do anything in your `serverless.yml` file. When you run `sls deploy` the Enterprise Plugin will identify the deployment profile associated with the application or stage and it will generate the AWS Access Keys using the associated AWS Access Role automatically.

## Deploy using AWS Access Roles

Thatâ€™s it! You are now ready to deploy using the new Serverless Framework Enterprise AWS Access Roles.

```
serverless deploy
```
